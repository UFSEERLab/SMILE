<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SMILE">
<title>old_vs_new â€¢ SMILE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="old_vs_new">
<meta property="og:description" content="SMILE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SMILE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/old_vs_new.html">old_vs_new</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>old_vs_new</h1>
            
      
      
      <div class="d-none name"><code>old_vs_new.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ufseerlab.github.io/SMILE/">SMILE</a></span><span class="op">)</span></span></code></pre></div>
<p>Testing if the new function can recreate all the previous scenarios
and new ones. Having a main function will help with the iteration and
testing of the vaccine scenarios.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># OG functions </span></span>
<span></span>
<span><span class="co"># This code is the source of functions that define the SMILE model.</span></span>
<span><span class="co"># It is a compilation of functions required to evalluate the model with different </span></span>
<span><span class="co"># assumptions starting from the determinisitc simple model withou population dynamics</span></span>
<span><span class="co"># or seasonal forcing and ending with the stochastic version of the model with </span></span>
<span><span class="co"># population dynamics and seasonal forcing. It also includes some useful functions </span></span>
<span><span class="co"># evaluated inside the functions to simulate the time series.</span></span>
<span><span class="co"># Finally I provide the functions required to estimate the parameters of the model</span></span>
<span><span class="co"># using maximum likelihood optimization through the optim function.</span></span>
<span></span>
<span><span class="co"># Author: Juan Pablo Gomez</span></span>
<span><span class="co"># Version 1.1.</span></span>
<span><span class="co"># Last revised: March 7 2018.</span></span>
<span></span>
<span><span class="co">#################################</span></span>
<span><span class="co"># Infection probability based on Ponciano and Capistran 2011.</span></span>
<span><span class="va">lambda.t</span>    <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>,<span class="va">tau</span>,<span class="va">b</span>,<span class="va">E</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">theta</span><span class="op">/</span><span class="op">(</span><span class="va">theta</span><span class="op">+</span><span class="va">b</span><span class="op">*</span><span class="va">E</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="va">tau</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Introducing seasonality in the infection probability through b.</span></span>
<span></span>
<span><span class="va">b.season</span>    <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">t</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">/</span><span class="va">period</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Density dependent reproduction</span></span>
<span></span>
<span><span class="va">rho.n</span>   <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="fl">0.41</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="va">N</span><span class="op">/</span><span class="fl">5000</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># First case of R0</span></span>
<span></span>
<span><span class="va">r0</span>  <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b</span>,<span class="va">E</span>,<span class="va">theta</span>,<span class="va">tau</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="op">(</span><span class="va">b</span><span class="op">*</span><span class="va">E</span><span class="op">*</span><span class="va">tau</span><span class="op">)</span><span class="op">/</span><span class="va">theta</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to simulate climatic variable</span></span>
<span><span class="co"># a = upper asymptote</span></span>
<span><span class="co"># c = lower asymptote</span></span>
<span><span class="co"># b = time required to reach half of the climatic maxima</span></span>
<span><span class="co"># d = time at which the mid point between max and minimum climate is reached.</span></span>
<span><span class="va">clim.func</span>   <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">a</span>,<span class="va">c</span>,<span class="va">d</span>,<span class="va">d2</span>,<span class="va">b</span>,<span class="va">b2</span>,<span class="va">t</span>,<span class="va">sd</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">b2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">c</span><span class="op">&lt;-</span><span class="fl">0</span><span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">det.clim</span>    <span class="op">&lt;-</span>   <span class="op">(</span><span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="va">c</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">(</span><span class="va">d</span><span class="op">-</span><span class="va">t</span><span class="op">)</span><span class="op">/</span><span class="va">b</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="va">c</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">(</span><span class="va">d2</span><span class="op">-</span><span class="va">t</span><span class="op">)</span><span class="op">/</span><span class="va">b2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">c</span></span>
<span>    <span class="va">rand.clim</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,<span class="va">det.clim</span>,sd<span class="op">=</span><span class="va">sd</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">rand.clim</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function used to estimate seasonality in infection probability using climatic variables</span></span>
<span><span class="co"># wt.bar = mean of climatic covariable</span></span>
<span><span class="co"># b0 = as in b.season</span></span>
<span><span class="co"># b1 = as in b.season</span></span>
<span><span class="co"># kw = scaling coefficient</span></span>
<span><span class="co"># t = time</span></span>
<span><span class="co"># period = as in b.season</span></span>
<span></span>
<span><span class="va">infect2clim</span> <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">wt.bar</span>,<span class="va">b0</span>,<span class="va">b1</span>,<span class="va">kw</span>,<span class="va">t</span>,<span class="va">period</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">wt.bar</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">b0</span><span class="op">*</span><span class="va">b1</span><span class="op">)</span><span class="op">/</span><span class="va">kw</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">/</span><span class="va">period</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function of SMILE without any age structuring</span></span>
<span><span class="co"># This is the most basic SMILE function in which I have assumed no population dynamics</span></span>
<span><span class="co"># and no deaths other than disease related. </span></span>
<span><span class="co"># Fixed parameters are: </span></span>
<span><span class="co"># alpha= 1/52 Probability of an immune individual to become Suceptible </span></span>
<span><span class="co"># zeta = 0.88 Probability that an Infected individual becomes immune</span></span>
<span><span class="co"># gamma= 0.9868 Spore decay probability</span></span>
<span><span class="co"># psi = 1 Number of spores in one LIZ</span></span>
<span></span>
<span><span class="co"># Variable parameters</span></span>
<span><span class="co"># b: Number of infections caused by one LIZ if there was no dispersion effort</span></span>
<span><span class="co"># tau and theta: Shape and Rate parameters of the gamma distribution defining dispersion effort.</span></span>
<span></span>
<span><span class="va">smile1</span>  <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span>            </span>
<span>    <span class="co"># Fixed parameters</span></span>
<span>    <span class="va">alpha</span>   <span class="op">&lt;-</span>  <span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>    <span class="va">zeta</span>    <span class="op">&lt;-</span>  <span class="fl">0.88</span></span>
<span>    <span class="va">gamma</span>   <span class="op">&lt;-</span>  <span class="fl">0.9868</span></span>
<span>    <span class="va">psi</span>     <span class="op">&lt;-</span>  <span class="fl">1</span>    </span>
<span>    </span>
<span>    <span class="va">n.weeks</span>     <span class="op">&lt;-</span>  <span class="va">years</span><span class="op">*</span><span class="fl">52</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">S</span><span class="op">&lt;-</span> <span class="va">M</span><span class="op">&lt;-</span> <span class="va">I</span><span class="op">&lt;-</span> <span class="va">L</span><span class="op">&lt;-</span><span class="va">E</span> <span class="op">&lt;-</span><span class="va">N</span><span class="op">&lt;-</span><span class="va">lambda</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="fl">5000</span></span>
<span>    <span class="va">S</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fl">1</span>; <span class="va">E</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">psi</span>    </span>
<span>    </span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">{</span></span>
<span>        </span>
<span>        <span class="va">tm1</span> <span class="op">&lt;-</span>  <span class="va">t</span><span class="op">-</span><span class="fl">1</span></span>
<span>        <span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">lambda.t</span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>,tau<span class="op">=</span><span class="va">tau</span>,b<span class="op">=</span><span class="va">b</span>,E<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>        <span class="va">I</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span></span>
<span>        <span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">zeta</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">L</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">zeta</span><span class="op">)</span></span>
<span>        <span class="va">E</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">psi</span><span class="op">*</span><span class="va">L</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">+</span> <span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">gamma</span></span>
<span>        <span class="va">N</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">+</span><span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span>            </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span></span>
<span>    <span class="va">results</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Suceptibles<span class="op">=</span><span class="va">S</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Immune<span class="op">=</span><span class="va">M</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Infected<span class="op">=</span><span class="va">I</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,LIZ<span class="op">=</span><span class="va">L</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Environment<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,lambda<span class="op">=</span><span class="va">lambda</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># This function simulates anthrax disease dynamics without host population dynamics</span></span>
<span><span class="co"># but infection probability has seasonal forcing.</span></span>
<span><span class="co"># Fixed parameter are the same as in smile1 function. </span></span>
<span><span class="co"># Variable parameters tau and theta are also the same and b0, b1 and period </span></span>
<span><span class="co"># introduce seasonality to the infection probability by modifying b. In this function</span></span>
<span><span class="co"># I assume that seasonality is product of an exponential cosine function where the intensity </span></span>
<span><span class="co"># of the seasonality is given by b0*b1 and period gives the periodicity of the outbreak</span></span>
<span><span class="co"># tau and theta: Shape and Rate parameters of the gamma distribution defining dispersion effort.</span></span>
<span><span class="co"># period: is the period in weeks of the exponential sinusoid function</span></span>
<span></span>
<span><span class="va">smile2</span>  <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span>            </span>
<span>    <span class="co"># Fixed parameters</span></span>
<span>    <span class="va">alpha</span>   <span class="op">&lt;-</span>  <span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>    <span class="va">zeta</span>    <span class="op">&lt;-</span>  <span class="fl">0.88</span></span>
<span>    <span class="va">gamma</span>   <span class="op">&lt;-</span>  <span class="fl">0.9868</span></span>
<span>    <span class="va">psi</span>     <span class="op">&lt;-</span>  <span class="fl">1</span>    </span>
<span>    </span>
<span>    <span class="va">n.weeks</span>     <span class="op">&lt;-</span>  <span class="va">years</span><span class="op">*</span><span class="fl">52</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">S</span><span class="op">&lt;-</span> <span class="va">M</span><span class="op">&lt;-</span> <span class="va">I</span><span class="op">&lt;-</span> <span class="va">L</span><span class="op">&lt;-</span><span class="va">E</span> <span class="op">&lt;-</span><span class="va">N</span><span class="op">&lt;-</span><span class="va">lambda</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="fl">5000</span></span>
<span>    <span class="va">S</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fl">1</span>; <span class="va">E</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">psi</span>    </span>
<span>    </span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">{</span></span>
<span>        </span>
<span>        <span class="va">tm1</span> <span class="op">&lt;-</span>  <span class="va">t</span><span class="op">-</span><span class="fl">1</span></span>
<span>        <span class="va">b</span>   <span class="op">&lt;-</span>  <span class="fu">b.season</span><span class="op">(</span>b0<span class="op">=</span><span class="va">b0</span>,b1<span class="op">=</span><span class="va">b1</span>,period<span class="op">=</span><span class="va">period</span>,t<span class="op">=</span><span class="va">t</span><span class="op">)</span></span>
<span>        <span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">lambda.t</span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>,tau<span class="op">=</span><span class="va">tau</span>,b<span class="op">=</span><span class="va">b</span>,E<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>        <span class="va">I</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span></span>
<span>        <span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">zeta</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">L</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">zeta</span><span class="op">)</span></span>
<span>        <span class="va">E</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">psi</span><span class="op">*</span><span class="va">L</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">+</span> <span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">gamma</span></span>
<span>        <span class="va">N</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">+</span><span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span>            </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span></span>
<span>    <span class="va">results</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Suceptibles<span class="op">=</span><span class="va">S</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Immune<span class="op">=</span><span class="va">M</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Infected<span class="op">=</span><span class="va">I</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,LIZ<span class="op">=</span><span class="va">L</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Environment<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,lambda<span class="op">=</span><span class="va">lambda</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># In this function I introduce population dynamics only as births at the begining of the year</span></span>
<span><span class="co"># determined by density dependent reproduction with a carrying capacity of 5000.</span></span>
<span></span>
<span><span class="va">smile3</span>  <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span>            </span>
<span>    <span class="co"># Fixed parameters</span></span>
<span>    <span class="va">alpha</span>   <span class="op">&lt;-</span>  <span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>    <span class="va">zeta</span>    <span class="op">&lt;-</span>  <span class="fl">0.88</span></span>
<span>    <span class="va">gamma</span>   <span class="op">&lt;-</span>  <span class="fl">0.9868</span></span>
<span>    <span class="va">psi</span>     <span class="op">&lt;-</span>  <span class="fl">1</span>    </span>
<span>    </span>
<span>    <span class="va">n.weeks</span>     <span class="op">&lt;-</span>  <span class="va">years</span><span class="op">*</span><span class="fl">52</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">S</span><span class="op">&lt;-</span> <span class="va">M</span><span class="op">&lt;-</span> <span class="va">I</span><span class="op">&lt;-</span> <span class="va">L</span><span class="op">&lt;-</span><span class="va">E</span> <span class="op">&lt;-</span><span class="va">N</span><span class="op">&lt;-</span><span class="va">lambda</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="fl">5000</span></span>
<span>    <span class="va">S</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    </span>
<span>    <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fl">1</span>; <span class="va">E</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">psi</span>    </span>
<span>    </span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">{</span></span>
<span>                </span>
<span>        <span class="va">tm1</span> <span class="op">&lt;-</span>  <span class="va">t</span><span class="op">-</span><span class="fl">1</span></span>
<span>        <span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">lambda.t</span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>,tau<span class="op">=</span><span class="va">tau</span>,b<span class="op">=</span><span class="va">b</span>,E<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">births.happen</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">52</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span>        <span class="va">rep.prob</span>    <span class="op">&lt;-</span>  <span class="fu">rho.n</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span> <span class="op">+</span> <span class="va">rep.prob</span><span class="op">*</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">births.happen</span></span>
<span>        <span class="va">I</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span></span>
<span>        <span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">zeta</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">L</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">zeta</span><span class="op">)</span></span>
<span>        <span class="va">E</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">psi</span><span class="op">*</span><span class="va">L</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">+</span> <span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">gamma</span></span>
<span>        <span class="va">N</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">+</span><span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span>            </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span></span>
<span>    <span class="va">results</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Suceptibles<span class="op">=</span><span class="va">S</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Immune<span class="op">=</span><span class="va">M</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Infected<span class="op">=</span><span class="va">I</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,LIZ<span class="op">=</span><span class="va">L</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Environment<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,lambda<span class="op">=</span><span class="va">lambda</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># smile 4 function introduces population dynamics as in smile3 function but uses </span></span>
<span><span class="co"># seasonal forcing for infection probability.</span></span>
<span></span>
<span><span class="va">smile4</span>  <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span>            </span>
<span>    <span class="co"># Fixed parameters</span></span>
<span>    <span class="va">alpha</span>   <span class="op">&lt;-</span>  <span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>    <span class="va">zeta</span>    <span class="op">&lt;-</span>  <span class="fl">0.88</span></span>
<span>    <span class="va">gamma</span>   <span class="op">&lt;-</span>  <span class="fl">0.9868</span></span>
<span>    <span class="va">psi</span>     <span class="op">&lt;-</span>  <span class="fl">1</span>    </span>
<span>    </span>
<span>    <span class="va">n.weeks</span>     <span class="op">&lt;-</span>  <span class="va">years</span><span class="op">*</span><span class="fl">52</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">S</span><span class="op">&lt;-</span> <span class="va">M</span><span class="op">&lt;-</span> <span class="va">I</span><span class="op">&lt;-</span> <span class="va">L</span><span class="op">&lt;-</span><span class="va">E</span> <span class="op">&lt;-</span><span class="va">N</span><span class="op">&lt;-</span><span class="va">lambda</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="fl">5000</span></span>
<span>    <span class="va">S</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    </span>
<span>    <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fl">1</span>; <span class="va">E</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">psi</span>    </span>
<span>    </span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">{</span></span>
<span>                </span>
<span>        <span class="va">tm1</span> <span class="op">&lt;-</span>  <span class="va">t</span><span class="op">-</span><span class="fl">1</span></span>
<span>        <span class="va">b</span>   <span class="op">&lt;-</span>  <span class="fu">b.season</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">t</span><span class="op">)</span></span>
<span>        <span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">lambda.t</span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>,tau<span class="op">=</span><span class="va">tau</span>,b<span class="op">=</span><span class="va">b</span>,E<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">births.happen</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">52</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span>        <span class="va">rep.prob</span>    <span class="op">&lt;-</span>  <span class="fu">rho.n</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span> <span class="op">+</span> <span class="va">rep.prob</span><span class="op">*</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">births.happen</span></span>
<span>        <span class="va">I</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span></span>
<span>        <span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">zeta</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">L</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">zeta</span><span class="op">)</span></span>
<span>        <span class="va">E</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">psi</span><span class="op">*</span><span class="va">L</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">+</span> <span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">gamma</span></span>
<span>        <span class="va">N</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">+</span><span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span>            </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span></span>
<span>    <span class="va">results</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Suceptibles<span class="op">=</span><span class="va">S</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Immune<span class="op">=</span><span class="va">M</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Infected<span class="op">=</span><span class="va">I</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,LIZ<span class="op">=</span><span class="va">L</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Environment<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,lambda<span class="op">=</span><span class="va">lambda</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># smile5 is the most realistic function of the group since it incorporates both births and deaths from other causes</span></span>
<span><span class="co"># than the disease in population dynamics. Deaths are given by a 1- sigmaa = 1 - 0.92^(1/52)</span></span>
<span><span class="va">smile5</span>  <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span>            </span>
<span>    <span class="co"># Fixed parameters</span></span>
<span>    <span class="va">alpha</span>   <span class="op">&lt;-</span>  <span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>    <span class="va">zeta</span>    <span class="op">&lt;-</span>  <span class="fl">0.88</span></span>
<span>    <span class="va">gamma</span>   <span class="op">&lt;-</span>  <span class="fl">0.9868</span></span>
<span>    <span class="va">sigmaa</span>  <span class="op">&lt;-</span>  <span class="fl">0.92</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span></span>
<span>    <span class="va">psi</span>     <span class="op">&lt;-</span>  <span class="fl">1</span>    </span>
<span>    </span>
<span>    <span class="va">n.weeks</span>     <span class="op">&lt;-</span>  <span class="va">years</span><span class="op">*</span><span class="fl">52</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">S</span><span class="op">&lt;-</span> <span class="va">M</span><span class="op">&lt;-</span> <span class="va">I</span><span class="op">&lt;-</span> <span class="va">L</span><span class="op">&lt;-</span><span class="va">E</span> <span class="op">&lt;-</span><span class="va">N</span><span class="op">&lt;-</span><span class="va">lambda</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="fl">5000</span></span>
<span>    <span class="va">S</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    </span>
<span>    <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fl">1</span>; <span class="va">E</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">psi</span>    </span>
<span>    </span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">{</span></span>
<span>                </span>
<span>        <span class="va">tm1</span> <span class="op">&lt;-</span>  <span class="va">t</span><span class="op">-</span><span class="fl">1</span></span>
<span>        <span class="va">b</span>   <span class="op">&lt;-</span>  <span class="fu">b.season</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">t</span><span class="op">)</span></span>
<span>        <span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">lambda.t</span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>,tau<span class="op">=</span><span class="va">tau</span>,b<span class="op">=</span><span class="va">b</span>,E<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">births.happen</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">52</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span>        <span class="va">rep.prob</span>    <span class="op">&lt;-</span>  <span class="fu">rho.n</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">sigmaa</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">sigmaa</span><span class="op">*</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span> <span class="op">+</span> <span class="va">rep.prob</span><span class="op">*</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">births.happen</span></span>
<span>        <span class="va">I</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span></span>
<span>        <span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">zeta</span> <span class="op">+</span> <span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">sigmaa</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">L</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">zeta</span><span class="op">)</span></span>
<span>        <span class="va">E</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">psi</span><span class="op">*</span><span class="va">L</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">+</span> <span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">*</span><span class="va">gamma</span></span>
<span>        <span class="va">N</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">+</span><span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span>            </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span></span>
<span>    <span class="va">results</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Suceptibles<span class="op">=</span><span class="va">S</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Immune<span class="op">=</span><span class="va">M</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Infected<span class="op">=</span><span class="va">I</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,LIZ<span class="op">=</span><span class="va">L</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Environment<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Final function is the stochastic version of smile5 function. It incorporates births, deaths by disease</span></span>
<span><span class="co"># and other causes and seasonal forcing of the infection probability. The stochasticity is introduced by </span></span>
<span><span class="co"># assuming that Infected, Immune and LIZ are all binomial random variables. I allowed stochasticity in the </span></span>
<span><span class="co"># number of spores introduced to the environment by assuming that it is poisson random variable with mean</span></span>
<span><span class="co"># given by the number of diseas deaths times a constant. Virulence of spores that remain virulent in the </span></span>
<span><span class="co"># environment is also a binomial random variable with with probability of succes gamma = 0.9868.</span></span>
<span></span>
<span><span class="va">smile5.stoch</span>    <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span>            </span>
<span>    <span class="co"># Fixed parameters</span></span>
<span>    <span class="va">alpha</span>   <span class="op">&lt;-</span>  <span class="fl">1</span><span class="op">/</span><span class="fl">52</span></span>
<span>    <span class="va">zeta</span>    <span class="op">&lt;-</span>  <span class="fl">0.88</span></span>
<span>    <span class="va">gamma</span>   <span class="op">&lt;-</span>  <span class="fl">0.9868</span></span>
<span>    <span class="va">sigmaa</span>  <span class="op">&lt;-</span>  <span class="fl">0.92</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span></span>
<span>    <span class="va">psi</span>     <span class="op">&lt;-</span>  <span class="fl">1</span>    </span>
<span>    </span>
<span>    <span class="va">n.weeks</span>     <span class="op">&lt;-</span>  <span class="va">years</span><span class="op">*</span><span class="fl">52</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">S</span><span class="op">&lt;-</span> <span class="va">M</span><span class="op">&lt;-</span> <span class="va">I</span><span class="op">&lt;-</span> <span class="va">L</span><span class="op">&lt;-</span><span class="va">E</span> <span class="op">&lt;-</span><span class="va">N</span><span class="op">&lt;-</span><span class="va">lambda</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="fl">5000</span></span>
<span>    <span class="va">S</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="op">&lt;-</span>  <span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    </span>
<span>    <span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fl">1</span>; <span class="va">E</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">L</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">psi</span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n.weeks</span><span class="op">)</span><span class="op">{</span></span>
<span>                </span>
<span>        <span class="va">tm1</span> <span class="op">&lt;-</span>  <span class="va">t</span><span class="op">-</span><span class="fl">1</span></span>
<span>        <span class="va">b</span>   <span class="op">&lt;-</span>  <span class="fu">b.season</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">t</span><span class="op">)</span></span>
<span>        <span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">lambda.t</span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>,tau<span class="op">=</span><span class="va">tau</span>,b<span class="op">=</span><span class="va">b</span>,E<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">births.happen</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">52</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span>        <span class="va">rep.prob</span>    <span class="op">&lt;-</span>  <span class="fu">rho.n</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">I</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span>,<span class="va">lambda</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">births</span>  <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span>,<span class="va">rep.prob</span><span class="op">)</span><span class="op">*</span><span class="va">births.happen</span></span>
<span>        <span class="va">M.surv</span>  <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">M</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span>,<span class="va">sigmaa</span><span class="op">)</span></span>
<span>        <span class="va">M.recov</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">M.surv</span>,<span class="va">alpha</span><span class="op">)</span></span>
<span>        <span class="va">M.new</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span>,<span class="va">zeta</span><span class="op">)</span></span>
<span>        <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">S</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">-</span><span class="va">I</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>,<span class="va">sigmaa</span><span class="op">)</span> <span class="op">+</span> <span class="va">M.recov</span> <span class="op">+</span> <span class="va">births</span></span>
<span>        <span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">M.new</span> <span class="op">+</span> <span class="op">(</span><span class="va">M.surv</span> <span class="op">-</span> <span class="va">M.recov</span><span class="op">)</span></span>
<span>        <span class="va">L</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="op">(</span><span class="va">I</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">-</span><span class="va">M.new</span><span class="op">)</span></span>
<span>        <span class="va">E</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">psi</span><span class="op">*</span><span class="va">L</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">E</span><span class="op">[</span><span class="va">tm1</span><span class="op">]</span>,<span class="va">gamma</span><span class="op">)</span></span>
<span>        <span class="va">N</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="va">S</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">+</span><span class="va">M</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span>            </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span></span>
<span>    <span class="va">results</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Suceptibles<span class="op">=</span><span class="va">S</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Immune<span class="op">=</span><span class="va">M</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Infected<span class="op">=</span><span class="va">I</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,LIZ<span class="op">=</span><span class="va">L</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>                        ,Environment<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Functions for estimating the parameters of the SMILE model b0, b1, period, theta and tau.</span></span>
<span><span class="co"># The estimation assumes that the observed LIZ are poisson distributed product of observation error</span></span>
<span><span class="co"># and not process error as properly described in the smile5.stoch function. This is a set of two functions</span></span>
<span><span class="co"># the first one gives the negative loglikelihood of the model that will be minimized using the optim function.</span></span>
<span><span class="co"># The second one is a wrapper of the optim function that returns the maximum likelihood estimates of the parameters.</span></span>
<span><span class="co"># Period must be in weeks and SMILE.obs must follow exactly the formating of the output of one of the above SMILE </span></span>
<span><span class="co"># functions.</span></span>
<span></span>
<span><span class="va">LIZ.negll</span>   <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">pars</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>,<span class="va">tau</span>,<span class="va">b0</span>,<span class="va">b1</span><span class="op">)</span>,<span class="va">period</span>,<span class="va">years</span>,<span class="va">SMILE.obs</span><span class="op">)</span><span class="op">{</span></span>
<span>        </span>
<span>    <span class="va">theta</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">tau</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">b0</span>      <span class="op">&lt;-</span>  <span class="va">pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">b1</span>      <span class="op">&lt;-</span>  <span class="va">pars</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="co"># Likelihood of infection seasonality as a function of climate</span></span>
<span>    </span>
<span>    <span class="co">#wt.bar.hat &lt;-  mean(clim)</span></span>
<span>    <span class="co">#clim.pred  &lt;-  infect2clim(wt.bar=wt.bar.hat,b0=b0,b1=b1,kw=kw,t=1:length(clim),period=period)</span></span>
<span>    <span class="co">#clim.ssq   &lt;-  sum((clim-clim.pred)^2)</span></span>
<span>    </span>
<span>    <span class="va">SMILE.pred</span>  <span class="op">&lt;-</span>  <span class="fu">smile5</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">period</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">years</span><span class="op">)</span></span>
<span>    <span class="va">ts2keep</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">SMILE.pred</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">SMILE.obs</span><span class="op">)</span></span>
<span>    <span class="va">SMILE.pred</span>  <span class="op">&lt;-</span>  <span class="va">SMILE.pred</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ts2keep</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">loglik.ls</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SMILE.obs</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SMILE.obs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        </span>
<span>        <span class="va">loglik.ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>  <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">SMILE.obs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="va">SMILE.pred</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>        </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">loglik.ls</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">loglik.ls</span>,<span class="va">sum</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">loglik</span>  <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">loglik.ls</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">loglik</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">loglik</span><span class="op">=</span><span class="op">-</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">}</span></span>
<span>    <span class="va">negll</span>   <span class="op">&lt;-</span>  <span class="op">-</span><span class="va">loglik</span> <span class="co">#+ clim.ssq</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">negll</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">SMILE.param.estim</span>   <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">b0</span>,<span class="va">b1</span>,<span class="va">theta</span>,<span class="va">tau</span>,<span class="va">period</span>,<span class="va">SMILE.obs</span>,<span class="va">method</span><span class="op">=</span><span class="st">"BFGS"</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">years</span>       <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SMILE.obs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">52</span></span>
<span>    <span class="va">pars</span>        <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>,<span class="va">tau</span>,<span class="va">b0</span>,<span class="va">b1</span><span class="op">)</span></span>
<span>            </span>
<span>    <span class="va">optim.res</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span>par<span class="op">=</span><span class="va">pars</span>,fn<span class="op">=</span><span class="va">LIZ.negll</span>,method<span class="op">=</span><span class="va">method</span>,SMILE.obs<span class="op">=</span><span class="va">SMILE.obs</span></span>
<span>                                ,years<span class="op">=</span><span class="va">years</span>,period<span class="op">=</span><span class="va">period</span><span class="op">)</span></span>
<span>        </span>
<span>    <span class="va">theta.hat</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">optim.res</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">tau.hat</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">optim.res</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">b0.hat</span>      <span class="op">&lt;-</span>  <span class="va">optim.res</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">b1.hat</span>      <span class="op">&lt;-</span>  <span class="va">optim.res</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span>    </span>
<span>    <span class="va">neg.ll</span>      <span class="op">&lt;-</span>  <span class="va">optim.res</span><span class="op">$</span><span class="va">value</span></span>
<span>    </span>
<span>    <span class="va">results</span>     <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>tau<span class="op">=</span><span class="va">tau.hat</span>,theta<span class="op">=</span><span class="va">theta.hat</span>,b0<span class="op">=</span><span class="va">b0.hat</span>,b1<span class="op">=</span><span class="va">b1.hat</span>,loglik<span class="op">=</span><span class="op">-</span><span class="va">neg.ll</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="smile1">smile1<a class="anchor" aria-label="anchor" href="#smile1"></a>
</h2>
<p>No age structuring, infection probability is not seasonal</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tau</span><span class="op">=</span><span class="fl">10</span></span>
<span><span class="va">b</span><span class="op">=</span><span class="fl">0.001</span></span>
<span></span>
<span><span class="co"># Case 1.0: Low Dispersion. Mean dispersion effort is 0.1</span></span>
<span><span class="va">theta</span><span class="op">=</span><span class="fl">100</span></span>
<span><span class="va">sim1.0</span>  <span class="op">&lt;-</span>  <span class="fu">smile1</span><span class="op">(</span>b<span class="op">=</span><span class="va">b</span>,tau<span class="op">=</span><span class="va">tau</span>,theta<span class="op">=</span><span class="va">theta</span>,years<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To recreate this scenario with the new function:</span></span>
<span><span class="va">sim1_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">10</span>, b_fixed <span class="op">=</span> <span class="fl">0.001</span>, theta <span class="op">=</span> <span class="fl">100</span>, years <span class="op">=</span> <span class="fl">10</span>, age_struc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-6-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="smile2">smile2<a class="anchor" aria-label="anchor" href="#smile2"></a>
</h2>
<p>This function simulates anthrax disease dynamics without host
population dynamics but infection probability has seasonal forcing.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Case 2: No age structuring, infection probability has seasonal forcing</span></span>
<span><span class="va">tau</span><span class="op">=</span><span class="fl">10</span></span>
<span><span class="va">b0</span><span class="op">=</span><span class="op">-</span><span class="fl">30</span></span>
<span><span class="va">b1</span><span class="op">=</span><span class="fl">0.85</span></span>
<span><span class="va">period</span><span class="op">=</span><span class="fl">3</span><span class="op">*</span><span class="fl">52</span></span>
<span></span>
<span><span class="co"># Case 2.0: Low dispersion</span></span>
<span><span class="va">theta</span><span class="op">=</span><span class="fl">100</span></span>
<span><span class="va">sim2.0</span>  <span class="op">&lt;-</span>  <span class="fu">smile2</span><span class="op">(</span>b0<span class="op">=</span><span class="va">b0</span>,b1<span class="op">=</span><span class="va">b1</span>,period<span class="op">=</span><span class="va">period</span>,tau<span class="op">=</span><span class="va">tau</span>,theta<span class="op">=</span><span class="va">theta</span>,years<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sim2_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>b0 <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, b1 <span class="op">=</span> <span class="fl">0.85</span>, period <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fl">52</span>, theta <span class="op">=</span> <span class="fl">100</span>, tau <span class="op">=</span> <span class="fl">10</span>, years <span class="op">=</span> <span class="fl">10</span>, age_struc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-9-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="smile3">smile3<a class="anchor" aria-label="anchor" href="#smile3"></a>
</h2>
<p>Only births with no seasonal infection probability</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Case 3: With births and no seasonal infection probability</span></span>
<span><span class="va">tau</span><span class="op">=</span><span class="fl">10</span></span>
<span><span class="va">b</span><span class="op">=</span><span class="fl">0.001</span></span>
<span></span>
<span><span class="co"># Case 3.0: Low Dispersion. Mean dispersion effort is 0.1</span></span>
<span><span class="va">theta</span><span class="op">=</span><span class="fl">100</span></span>
<span><span class="va">sim3.0</span>  <span class="op">&lt;-</span>  <span class="fu">smile3</span><span class="op">(</span>b<span class="op">=</span><span class="va">b</span>,tau<span class="op">=</span><span class="va">tau</span>,theta<span class="op">=</span><span class="va">theta</span>,years<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If we don't consider seasonal forcing, then b0 and b1 are left as null (the default) and we give the parameter b_fixed for fixed infection probability</span></span>
<span><span class="va">sim3_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">10</span>, b_fixed <span class="op">=</span> <span class="fl">0.001</span>, theta <span class="op">=</span> <span class="fl">100</span>, years <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-12-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="smile4">smile4<a class="anchor" aria-label="anchor" href="#smile4"></a>
</h2>
<p>With births and seasonal forcing of infection</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tau</span><span class="op">=</span><span class="fl">10</span></span>
<span><span class="va">b0</span><span class="op">=</span><span class="op">-</span><span class="fl">30</span></span>
<span><span class="va">b1</span><span class="op">=</span><span class="fl">0.85</span></span>
<span><span class="va">period</span><span class="op">=</span><span class="fl">3</span><span class="op">*</span><span class="fl">52</span></span>
<span></span>
<span><span class="co"># Case 4.0: Low Dispersion. Mean dispersion effort is 0.1</span></span>
<span><span class="va">theta</span><span class="op">=</span><span class="fl">100</span></span>
<span><span class="va">sim4.0</span>  <span class="op">&lt;-</span>  <span class="fu">smile4</span><span class="op">(</span>b0<span class="op">=</span><span class="va">b0</span>,b1<span class="op">=</span><span class="va">b1</span>,period<span class="op">=</span><span class="va">period</span>,tau<span class="op">=</span><span class="va">tau</span>,theta<span class="op">=</span><span class="va">theta</span>,years<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In the function we change sigmaa = 1, since the smile4 function does not consider deaths from other causes.</span></span>
<span><span class="va">sim4_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>b0 <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, b1 <span class="op">=</span> <span class="fl">0.85</span>, period <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fl">52</span>, theta <span class="op">=</span> <span class="fl">100</span>, tau <span class="op">=</span> <span class="fl">10</span>, years <span class="op">=</span> <span class="fl">10</span>, sigmaa <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-15-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="smile5">smile5<a class="anchor" aria-label="anchor" href="#smile5"></a>
</h2>
<p>This one incorporates both host population dynamics and seasonal
forcing, but additionally puts in the death by other causes.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tau</span><span class="op">=</span><span class="fl">10</span></span>
<span><span class="va">b0</span><span class="op">=</span><span class="op">-</span><span class="fl">30</span></span>
<span><span class="va">b1</span><span class="op">=</span><span class="fl">0.85</span></span>
<span><span class="va">period</span><span class="op">=</span><span class="fl">3</span><span class="op">*</span><span class="fl">52</span></span>
<span></span>
<span><span class="co"># Case 5.0: Low Dispersion. Mean dispersion effort is 0.1</span></span>
<span><span class="va">theta</span><span class="op">=</span><span class="fl">10</span></span>
<span><span class="va">sim5.0</span>      <span class="op">&lt;-</span>  <span class="fu">smile5</span><span class="op">(</span>b0<span class="op">=</span><span class="va">b0</span>,b1<span class="op">=</span><span class="va">b1</span>,period<span class="op">=</span><span class="va">period</span>,tau<span class="op">=</span><span class="va">tau</span>,theta<span class="op">=</span><span class="va">theta</span>,years<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim5_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>b0 <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, b1 <span class="op">=</span> <span class="fl">0.85</span>, period <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fl">52</span>, theta <span class="op">=</span> <span class="fl">10</span>, tau <span class="op">=</span> <span class="fl">10</span>, years <span class="op">=</span> <span class="fl">10</span>, sigmaa <span class="op">=</span> <span class="fl">0.92</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-18-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="stochastic-version-of-the-last-one">Stochastic version of the last one:<a class="anchor" aria-label="anchor" href="#stochastic-version-of-the-last-one"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stochastic.sims</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">LIZ.stoch</span>       <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="fl">100</span>,ncol<span class="op">=</span><span class="fl">520</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>    <span class="va">stochastic.sims</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fu">smile5.stoch</span><span class="op">(</span>b0<span class="op">=</span><span class="va">b0</span>,b1<span class="op">=</span><span class="va">b1</span>,period<span class="op">=</span><span class="va">period</span>,tau<span class="op">=</span><span class="va">tau</span>,theta<span class="op">=</span><span class="va">theta</span>,years<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="va">LIZ.stoch</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>           <span class="op">&lt;-</span>  <span class="va">stochastic.sims</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LIZ</span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">stochastic_sims</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">LIZ_stoch</span>       <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="fl">100</span>,ncol<span class="op">=</span><span class="fl">520</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>    <span class="va">stochastic_sims</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>    <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>b0 <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, b1 <span class="op">=</span> <span class="fl">0.85</span>, period <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fl">52</span>, theta <span class="op">=</span> <span class="fl">10</span>, tau <span class="op">=</span> <span class="fl">10</span>, years <span class="op">=</span> <span class="fl">10</span>, sigmaa <span class="op">=</span> <span class="fl">0.92</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span>, stochastic <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">LIZ_stoch</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>           <span class="op">&lt;-</span>  <span class="va">stochastic.sims</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LIZ</span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">LIZ.stoch</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"sim"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">sim</span>, names_to <span class="op">=</span> <span class="st">"week"</span>, values_to <span class="op">=</span> <span class="st">"n_LIZ"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">week</span>, <span class="st">"V"</span><span class="op">)</span>, week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"OG"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">og_stochastic</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">LIZ_stoch</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"sim"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">sim</span>, names_to <span class="op">=</span> <span class="st">"week"</span>, values_to <span class="op">=</span> <span class="st">"n_LIZ"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">week</span>, <span class="st">"V"</span><span class="op">)</span>, week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"NEW"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">new_stochastic</span></span></code></pre></div>
<p>Very similar results, considering this is the stochastic versions. It
makes sense.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">og_stochastic</span>, <span class="va">new_stochastic</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># filter(sim %in% 10:15) %&gt;% </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n_LIZ</span>, group <span class="op">=</span> <span class="va">sim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># facet_grid(sim~model) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-22-1.png" width="700">
Try to get the estimates from these stochastic sims:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> </span>
<span><span class="va">b0_start</span>    <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,min<span class="op">=</span><span class="op">-</span><span class="fl">36</span>,max<span class="op">=</span><span class="op">-</span><span class="fl">24</span><span class="op">)</span> </span>
<span><span class="va">b1_start</span>    <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,min<span class="op">=</span><span class="fl">0.656</span>,max<span class="op">=</span><span class="fl">0.984</span><span class="op">)</span> </span>
<span><span class="va">theta_start</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,min<span class="op">=</span><span class="fl">8</span>,max<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">tau_start</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,min<span class="op">=</span><span class="fl">8</span>,max<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SMILE_obs</span> <span class="op">&lt;-</span> <span class="va">stochastic_sims</span></span>
<span><span class="va">nreps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SMILE_obs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hat_mat</span>         <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nreps</span>,<span class="fl">5</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nreps</span></span>
<span>                                                             ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tau"</span>,<span class="st">"theta"</span>,<span class="st">"b0"</span>,<span class="st">"b1"</span>,<span class="st">"loglik"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nreps</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">hat_mat</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/SMILE_param_estim.html">SMILE_param_estim</a></span><span class="op">(</span>b0 <span class="op">=</span> <span class="va">b0_start</span>,</span>
<span>                                     b1 <span class="op">=</span> <span class="va">b1_start</span>,</span>
<span>                                     theta <span class="op">=</span> <span class="va">theta_start</span>,</span>
<span>                                     tau <span class="op">=</span> <span class="va">tau_start</span>,</span>
<span>                                     SMILE.obs<span class="op">=</span><span class="va">SMILE_obs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,period<span class="op">=</span><span class="fl">3</span><span class="op">*</span><span class="fl">52</span><span class="op">)</span></span>
<span>                                <span class="op">}</span></span></code></pre></div>
<p>Parameter estimates for each of the stochastic simulations we
generated. All simulations used the values shown with the red line to be
generated.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># estimates from the stochastic simulations</span></span>
<span><span class="va">hat_mat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"run"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">run</span>, names_to <span class="op">=</span> <span class="st">"parameter"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">long_hatmat</span></span>
<span></span>
<span><span class="va">long_hatmat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op">==</span> <span class="st">"b0"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">b0_plot</span></span>
<span></span>
<span><span class="va">long_hatmat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op">==</span> <span class="st">"b1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.85</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">b1_plot</span></span>
<span></span>
<span><span class="va">long_hatmat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op">==</span> <span class="st">"theta"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">theta_plot</span></span>
<span></span>
<span><span class="va">long_hatmat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op">==</span> <span class="st">"tau"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">tau_plot</span></span>
<span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">b0_plot</span>, <span class="va">b1_plot</span>, <span class="va">theta_plot</span>, <span class="va">tau_plot</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="adding-vaccine">Adding vaccine<a class="anchor" aria-label="anchor" href="#adding-vaccine"></a>
</h2>
<p>I modified the main function so we use the same one and just change
the arguments.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">23</span></span>
<span><span class="va">vacc.pcts</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.34</span>, <span class="fl">0.24</span>, <span class="fl">0.37</span>, <span class="fl">0.44</span>, <span class="fl">0.44</span>, <span class="fl">0.64</span>, <span class="fl">0.71</span>, <span class="fl">0.69</span>, <span class="fl">0.73</span>, </span>
<span>              <span class="fl">0.72</span>, <span class="fl">0.66</span>, <span class="fl">0.60</span>, <span class="fl">0.57</span>, <span class="fl">0.27</span>, <span class="fl">0.27</span>, <span class="fl">0.16</span>, <span class="fl">0.12</span>, <span class="fl">0.12</span>, </span>
<span>              <span class="fl">0.10</span>, <span class="fl">0.08</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.02</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vax_smile5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>b0 <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, b1 <span class="op">=</span> <span class="fl">0.85</span>, period <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fl">52</span>, theta <span class="op">=</span> <span class="fl">100</span>, tau <span class="op">=</span> <span class="fl">1</span>, years <span class="op">=</span> <span class="fl">23</span>, </span>
<span>                       beta_0 <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, beta_1 <span class="op">=</span> <span class="fl">7.4</span>, vax <span class="op">=</span> <span class="va">vacc.pcts</span>, N1 <span class="op">=</span> <span class="fl">20000</span>, K <span class="op">=</span> <span class="fl">50000</span>, output_df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vax_smile5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">week</span>, names_to <span class="op">=</span> <span class="st">"compartment"</span>, values_to <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>compartment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">compartment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"M"</span>, <span class="st">"I"</span>, <span class="st">"L"</span>, <span class="st">"E"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="section level3">
<h3 id="scenario-6-from-tans-where-we-have-no-seasonality-in-transmission">Scenario 6 from Tanâ€™s where we have no seasonality in
transmission<a class="anchor" aria-label="anchor" href="#scenario-6-from-tans-where-we-have-no-seasonality-in-transmission"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">vax_smile6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smile_fx.html">smile_fx</a></span><span class="op">(</span>b0 <span class="op">=</span> <span class="cn">NULL</span>, b1 <span class="op">=</span> <span class="cn">NULL</span>, period <span class="op">=</span> <span class="cn">NULL</span>, theta <span class="op">=</span> <span class="fl">100</span>, tau <span class="op">=</span> <span class="fl">1</span>, years <span class="op">=</span> <span class="fl">23</span>, </span>
<span>                       beta_0 <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, beta_1 <span class="op">=</span> <span class="fl">6.86</span>, vax <span class="op">=</span> <span class="va">vacc.pcts</span>, N1 <span class="op">=</span> <span class="fl">20000</span>, K <span class="op">=</span> <span class="fl">50000</span>, b_fixed <span class="op">=</span> <span class="fl">0.001</span>, output_df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vax_smile6</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">week</span>, names_to <span class="op">=</span> <span class="st">"compartment"</span>, values_to <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>compartment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">compartment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"M"</span>, <span class="st">"I"</span>, <span class="st">"L"</span>, <span class="st">"E"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="old_vs_new_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
